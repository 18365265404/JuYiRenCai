<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>聚一人才官网</title>
	</head>
	<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"> 
	<link rel="stylesheet" type="text/css" href="../style/pack/layui.css"/>
	<link rel="stylesheet" type="text/css" href="../style/pack/zzsc.css">
	<link rel="stylesheet" href="../style/pack/dcalendar.picker.css"/>
	<link rel="stylesheet" type="text/css" href="../style/base.css"/>
	<link rel="stylesheet" type="text/css" href="../style/style.css"/>
	
	
  </style>
	<script src="../js/pack/jquery-3.3.1.js" type="text/javascript" charset="utf-8"></script>
	<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="../js/pack/base64.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/pack/ajaxfileupload.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/pack/jquery-form.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.1/moment.min.js"></script>
	<script type="text/javascript" src="../js/pack/dcalendar.picker.js"></script>
	<body>
<!-----------------header------------------------>	
<div class="header"></div>
		<script type="text/javascript">
			$(function(){
				$(".header").load("../html/header2.html")
			})
		</script>


 <div class="consult-content" id="showCenter">
		
		<div class="consult-content-img">
			<form id="form1" enctype="multipart/form-data" action="" method="post" >
			<input type="file" name="image" id="file" value="上传图片" style="opacity: 0; height: 255px; background: red; position: absolute; z-index: 100;"/>
			<img src="../img/icon_camera.png"/ style="width: 100px;">
			<img id="upload-img" src=""/ style="width: 254px; height: 254px; position: absolute;left:0 ; top: -80px; display: none;">
			<button type="button" id="myForm" class="btn btn-success" style=" display: none;  position: absolute; top: 265px ;left:0;">上传图片
			</button>
			<button type="button" class="btn btn-success" style="width: 120px; position: absolute;left:68px; top: 190px;">本地上传图片</button>
			</form>
			
		</div>
		<div class="consult-content-message">
			<p style="font-size: 22px;">基本信息</p>
			<form class="form-horizontal" role="form" style="font-size: 14px; color: #333333;">
			  
			  
			  
			  
			  <div class="one-horizontal clearfix">
				  	<div class="form-group form-group1  pull-left clearfix" >
				    <label for="inputPassword" class="control-label pull-left" style="margin-left: 42px;">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名：</label>				    
						<input type="text" class="form-control xName pull-right" placeholder="请输入" style="width: 200px; margin-left: 15px;">
				    </div>
				  	<div class="form-group form-group1  pull-left clearfix"  style="margin-left: 20px;">
				    <label for="inputPassword" class="control-label pull-left" style="margin-left: 35px;">出生日期：&nbsp;&nbsp;&nbsp;&nbsp;</label>
					<input id='mydatepicker' type='text' class="dateOfBirth"  style="height: 32px; width: 200px;"/>
					</div>
			  </div>
			  <div class="one-horizontal clearfix">
				  	<div class="form-group form-group1  pull-left clearfix" >
				    <label for="inputPassword" class="control-label pull-left" style="margin-left: 42px;">籍&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;贯：</label>
				    
						<input type="text" class="form-control nativePlace pull-right" placeholder="请输入" style="width: 200px; margin-left: 15px;">
				    
				    </div>
				  	<div class="form-group form-group1  pull-left clearfix" style="margin-left: 55px;">
				    <label for="inputPassword" class="control-label   pull-left" >毕业院校：</label>				    
						<input type="text" class="form-control graduateSchool pull-right" placeholder="请输入" style="width: 200px; margin-left: 15px;">
				    </div>
			  </div>
			  <div class="one-horizontal clearfix">
				  	<div class="form-group form-group1  pull-left clearfix" >
				    <label for="inputPassword" class="control-label pull-left" style="margin-left: 42px;">邮&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;箱：</label>
				    
						<input type="text" class="form-control mailbox pull-right" placeholder="请输入" style="width: 200px; margin-left: 15px;">
				    
				    </div>
				  	<div class="form-group form-group1  pull-left clearfix" style="margin-left: 55px;">
				    <label for="inputPassword" class="control-label  pull-left" >手机号码：</label>				    
						<input type="text" class="form-control mobilePhone pull-right" placeholder="请输入" style="width: 200px; margin-left: 15px;">
				    </div>
			  </div>
			  
			  <div class="form-group form-group1">
			    <label for="inputPassword" class="col-sm-2 control-label">所学专业：</label>
			    <div class="col-sm-9 group-text">
					<input type="text" class="form-control majorInScience" placeholder="请输入">
			    </div>
			  </div>
			  
			  <div class="form-group form-group1">
			    <label for="inputPassword" class="col-sm-2 control-label">现居住地：</label>
			    <div class="col-sm-9 group-text">
					<input type="text" class="form-control currentResidence" placeholder="请输入">
			    </div>
			  </div>
			  
			  <div class="form-group form-group1">
			    <label for="inputPassword" class="col-sm-2 control-label">学习情况：</label>
			    <div class="col-sm-9 group-text">
					<input type="text" class="form-control learningSituation" placeholder="请输入">
			    </div>
			  </div>
			  
			  <div class="form-group form-group1">
			    <label for="inputPassword" class="col-sm-2 control-label">自我评价：</label>
			    <div class="col-sm-9 group-text" >
					<textarea class="form-control" id="selfEvaluation" class="selfEvaluation" rows="3" style="height: 100px;"></textarea>
			    </div>
			  </div>
			  
			  <div class="form-group form-group1">
			    <label for="inputPassword" class="col-sm-2 control-label">工作经验：</label>
			    <div class="col-sm-9 group-text" >
					<textarea class="form-control" id="workExperience" class="workExperience" rows="3" style="height: 150px;"></textarea>
			    </div>
			  </div>	
			  
			  <button type="button" class="btn btn-subment">提交所有信息</button>
			</form>
		</div>		
		
		<!-- 模态框（Modal） -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="myModalLabel">
							提示
						</h4>
					</div>
					<div class="modal-body" style="text-align: center;">
						
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭
						</button>

					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal -->
		</div>
 </div>

<!--导航栏二-->

 	<ul class="pop-top ">
 		<li><a>消息</a></li>
 		<li><a>二维码</a>
 			<div class="er-code">
 				<img src="../img/qrcode.png"/>
 				<p>扫描下载app</p>
 			</div>
 		</li>
 		<li class="go-top"><a href="#">顶部</a></li>
 		<li class="drag">拖动</li>
 	</ul>
<!---------------------------footer----------------------------------------->
<div class="footer"></div>
		<script type="text/javascript">
			$(function(){
				$(".footer").load("../html/footer3.html")
			})
		</script>		
	</body>

<!--表单提交-->


<script type="text/javascript">
		

$(function(){

  	$('#mydatepicker').dcalendarpicker(); 
	$('#mydatepicker2').dcalendarpicker({
		format:'yyyy-mm-dd'
	}); 
	$('#mycalendar').dcalendar();  
}); 
</script>

<script type="text/javascript">
	$(function(){
	//base64对象
	
	var uuid="";
	var globalUrl=""//用于判断是否选择图片
	var base64 = new Base64();  
	
	/**
	 * 图片显示部分
	 * */
	  $("#file").change(function(){
	  	
	  	
	  	$("#upload-img").show()
	    var objUrl = getObjectURL(this.files[0]) ;
	//  var formData = new FormData($("#uploadFormvideo")[0]);
	//  alert(formData) ;
		var formData=new FormData();
		formData.append("file",$("#file")[0].files[0]);
	//	console.log(formData.get("file"),"22222222222222222222222222222222222222")
		globalUrl=objUrl//设给全局值
		
	    if (objUrl) 
	    {
	      $("#upload-img").attr("src", objUrl);
	      $("#upload-img").removeClass("hide");
	    }
	  });
  
	
	

		//提交部分
		$(".btn-subment").click(function(){
//			alert($("#mydatepicker").val())
			var xName=$(".xName").val();//姓名1
			var dateOfBirth=$(".dateOfBirth").val();//出生年月2
			var nativePlace=$(".nativePlace").val();//籍贯3
			var graduateSchool=$(".graduateSchool").val();//毕业院校4
			var mailbox=$(".mailbox").val();//邮箱5
			var mobilePhone=$(".mobilePhone").val();//联系电话6
			var majorInScience=$(".majorInScience").val();//所学专业7
			var currentResidence=$(".currentResidence").val();//现居住地8
			var learningSituation=$(".learningSituation").val();//学习情况9
			var selfEvaluation=$("#selfEvaluation").val();//自我评价10
			var workExperience=$("#workExperience").val();//工作经验11
			//转base64的值

//			console.log("xName的值...."+xName
//						+"dateOfBirth的值...."+dateOfBirth
//						+"graduateSchool的值..."+graduateSchool
//						+"mailbox的值..."+mailbox
//						+"mobilePhone;的值..."+mobilePhone
//						+"majorInScience;的值..."+majorInScience
//						+"currentResidence的值..."+currentResidence
//						+"learningSituation;的值..."+learningSituation
//						+"selfEvaluation;的值..."+selfEvaluation
//						+"workExperience的值..."+workExperience
//			)
			

//			if(!globalUrl){
//					$('#myModal').modal('show');
//					$('.modal-body').html("请您填写完表单信息")
//			}
			 if(xName==""||
			    dateOfBirth==""||
				nativePlace==""||
				graduateSchool==""||
				mailbox==""||
				mobilePhone==""||
				majorInScience==""||
				currentResidence==""||
				learningSituation==""||
				selfEvaluation==""||
				workExperience==""){
					
					$('#myModal').modal('show');
					$('.modal-body').html("请您填写完表单信息")
			}else{
				$.ajax({
				type:"post",
				url:"http://47.100.237.163:8082/tsin/insert",//阿里云
//				url:"http://192.168.1.51:8082/tsin/insert",
				
             	dataType:"json",
				data:{      
					 xName : xName,//姓名
					 dateOfBirth : dateOfBirth,//出生日期
					 nativePlace : nativePlace,//籍贯
					 graduateSchool : graduateSchool,//毕业院校
					 mailbox : mailbox,//邮箱
					 mobilePhone:mobilePhone,//手机号码
					 majorInScience:majorInScience,//所学专业
					 currentResidence:currentResidence,//现住地址
					 learningSituation:learningSituation,//学习情况
					 selfEvaluation:selfEvaluation,//自我评价
					 workExperience:workExperience//工作经验
				},
				success:function(data){
//					console.log("答应的数据",)
					var firstStatus=data.status;
						switch (firstStatus){
							case 200:
								uuid=data.data;
								
								if(globalUrl){
									
									//如果有图片调用上传图片接口	
										$("#form1").attr("action","http://47.100.237.163:8082/qn/uploadImg"+"?personalUUID="+uuid);
//										$("#form1").attr("action","http://192.168.1.57:8082/qn/uploadImg"+"?personalUUID="+uuid);
										$("#form1").ajaxSubmit(function(data){
											
											var twoStatus=JSON.parse(data).status
											if(twoStatus==200){
												$('#myModal').modal('show')
												$('.modal-body').html("提交成功")
												setTimeout(function(){
													
													window.location.href="activity.html"
												},1000)
											}
				
				
										})
									}else{
//										$("#form1").attr("action","http://47.100.237.163:8082/qn/uploadImg"+"?personalUUID="+uuid);
//										$("#form1").ajaxSubmit(function(data){
//											
//											var twoStatus=JSON.parse(data).status
//											if(twoStatus==200){
//												$('#myModal').modal('show')
//												$('.modal-body').html("提交成功")
//												setTimeout(function(){
//													
//													window.location.href="activity.html"
//												},1000)
//											}
//				
//				
//										})
												$('#myModal').modal('show')
												$('.modal-body').html("提交成功")
												setTimeout(function(){
													
													window.location.href="activity.html"
												},1000)
									}
								
								
								break;
							default:
									$('#myModal').modal('show')
									$('.modal-body').html("数据请求异常，请稍后重试！！！")
								break;
						}
					
						
						

				},
				error:function(data){
//					alert("服务器异常！！！")
				}
				
			}); 
			}
			
			
//图片上传			
//			$.ajaxFileUpload({
//	            url: "http://192.168.1.57:8080/bcin/qiniuUpload",//用于文件上传的服务器端请求地址
//	            secureuri: false,//一般设置为false
//	            fileElementId: 'file',//文件上传控件的id属性  <input type="file" id="upload" name="upload" />
//	            dataType: 'text',//返回值类型 一般设置为json
//	            success: function (data){  //服务器成功响应处理函数
//
//	//                console.log(data);
//	//                $("#imageUrl").html(data);
////	                var img = "&lt;img src="+data+"&gt;"
////	                var html = "<br><span>"+img+"</span>";
////	                $("#imgurl").append(html);
//			alert(data)
//	            }
//	        });
			
				/** 验证文件是否导入成功  */
	$("#myForm").click(function(){
//		console.log("uuid111111111111111",uuid)
		$("#form1").attr("action","http://47.100.237.163/uploadImg"+"?uuid="+uuid);
		$("#form1").ajaxSubmit(function(data){
			
			$('#myModal').modal('show')
			$('.modal-body').html(data.data)
		})
	})
			
})
		
		
		//封装遍历后的所选中的check值的数组
		function getValue (obj){
				let arr=[];
				let str=""
			$(obj +':checked').each(function(){
			    arr.push($(this).val())
			    
			});
			
			for(var i= 0;i<arr.length;i++){
				str+=arr[i]+","

			}
			var strs=str.substring(0,str.length-1)
			return strs;
			}
	})
	
</script>
<script type="text/javascript">


  //建立一個可存取到該file的url
  function getObjectURL(file) {
    var url = null ;
    if (window.createObjectURL!=undefined) 
    { // basic
      url = window.createObjectURL(file) ;
    }
    else if (window.URL!=undefined) 
    {
      // mozilla(firefox)
      url = window.URL.createObjectURL(file) ;
    } 
    else if (window.webkitURL!=undefined) {
      // webkit or chrome
      url = window.webkitURL.createObjectURL(file) ;
    }
    return url ;
  }

</script>
</html>
